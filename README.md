
# README для add_friends.py

## Описание
`add_friends.py` — это Python-скрипт для автоматизации управления друзьями во ВКонтакте (VK) с использованием VK API. Скрипт выполняет следующие функции: устанавливает статус "онлайн", принимает входящие заявки в друзья и отправляет исходящие заявки на основе предложений VK. Он поддерживает работу с несколькими аккаунтами через токены, указанные в файле `tokens.txt`, и использует многопоточность для параллельной обработки.

## Возможности
- **Установка статуса "онлайн"**: Обновляет статус каждые 5 минут.
- **Принятие заявок в друзья**: Автоматически принимает входящие заявки, отклоняя запросы от деактивированных пользователей.
- **Отправка заявок в друзья**: Отправляет запросы на основе предложений VK (фильтр по общим друзьям).
- **Многопоточность**: Поддерживает одновременную работу с несколькими аккаунтами.
- **Обработка ошибок**: Логирует ошибки VK API и продолжает работу после паузы при определенных ошибках.
- **Грациозное завершение**: Останавливает выполнение при получении сигнала прерывания (Ctrl+C).

## Требования
- **Python**: 3.8 или выше
- **Зависимости**:
  ```
  pip install vk_api
  ```
- **Токены VK API**: Один или несколько токенов доступа VK, сохраненных в файле `tokens.txt`
- **Файл `tokens.txt`**: Текстовый файл с токенами (каждый токен на новой строке)

- **Токен VK API**:
  - **Через Kate Mobile**:
    1. Перейдите по [ссылке Kate Mobile](https://id.vk.com/auth?return_auth_hash=feae1c18342d33bb92&redirect_uri=https%3A%2F%2Foauth.vk.com%2Fblank.html&redirect_uri_hash=fc0d048a6a5bdf295f&force_hash=1&app_id=2685278&response_type=token&code_challenge=&code_challenge_method=&scope=1040183263&state=) **через браузер** (не используйте мобильное приложение).
    2. Авторизуйтесь в VK.
    3. После переадресации вы увидите URL вида: `https://oauth.vk.com/blank.html#access_token=vk1.a.ваш_токен&expires_in=86400&user_id=123456`.
    4. Скопируйте значение `access_token` (например, `vk1.a.GEX8jo_VOB...`). Это ваш токен.
  - **Альтернатива**: Создайте standalone-приложение на https://vk.com/dev, получите токен с правами `wall` и `newsfeed`.

## Установка
1. **Установите Python**: Убедитесь, что Python 3.8+ установлен.
2. **Скачайте скрипт**: Клонируйте или скачайте `add_friends.py`.
3. **Установите зависимости**:
   ```
   pip install vk_api
   ```
4. **Получите токены VK API**:
   - Перейдите по [ссылке Kate Mobile](https://id.vk.com/auth?return_auth_hash=feae1c18342d33bb92&redirect_uri=https%3A%2F%2Foauth.vk.com%2Fblank.html&redirect_uri_hash=fc0d048a6a5bdf295f&force_hash=1&app_id=2685278&response_type=token&code_challenge=&code_challenge_method=&scope=1040183263&state=) **через браузер** (не используйте мобильное приложение).
   - Авторизуйтесь в VK.
   - После переадресации URL будет выглядеть так: `https://oauth.vk.com/blank.html#access_token=vk1.a.ваш_токен&expires_in=86400&user_id=123456`.
   - Скопируйте значение `access_token` (например, `vk1.a.GEX8jo_VOB...`). Это ваш токен.
   - Альтернативно: Создайте standalone-приложение на https://vk.com/dev и получите токен с правами `friends` и `status`.
5. **Создайте файл `tokens.txt`**:
   - В той же папке, где находится `add_friends.py`, создайте файл `tokens.txt`.
   - Добавьте токены, каждый на новой строке, например:
     ```
     vk1.a.token1...
     vk1.a.token2...
     ```

## Настройка
1. **Подготовьте `tokens.txt`**:
   - Убедитесь, что файл `tokens.txt` находится в той же директории, что и скрипт.
   - Проверьте, что токены действительны и имеют необходимые права (`friends`, `status`).
2. **Настройте окружение**:
   - Убедитесь, что текущая рабочая директория содержит `add_friends.py` и `tokens.txt`.
   - Скрипт автоматически проверяет наличие файла токенов при запуске.

## Использование
1. **Запустите скрипт**:
   ```
   python add_friends.py
   ```
2. **Работа скрипта**:
   - Читает токены из `tokens.txt`.
   - Для каждого токена запускает отдельный поток обработки.
   - Выполняет три задачи для каждого аккаунта:
     - Устанавливает статус "онлайн" каждые 5 минут.
     - Проверяет и принимает входящие заявки в друзья каждые 5 минут, отклоняя запросы от деактивированных пользователей.
     - Отправляет исходящие заявки в друзья на основе предложений VK (фильтр по общим друзьям).
   - Логирует действия и ошибки в консоль с временными метками.
3. **Остановка**:
   - Нажмите `Ctrl+C` для грациозного завершения (скрипт завершит текущие операции и остановится).
   - Все потоки завершатся корректно, и программа закроется.

## Вывод
- **Консоль**: Выводит информацию о действиях (чтение токенов, установка статуса, принятие/отправка заявок) и ошибках с временными метками.
- **Логи**: Все сообщения в консоли включают дату и время в формате `ДД.ММ.ГГГГ ЧЧ:ММ:СС`.

## Настройка под себя
- **Задержки**:
  - В функции `set_online_status`: Измените `time.sleep(300)` для изменения частоты обновления статуса "онлайн".
  - В функции `accept_friend_requests`: Измените `time.sleep(300)` для изменения частоты проверки входящих заявок.
  - В функции `send_friend_requests`: Измените `time.sleep(0.3)` для изменения задержки между отправкой заявок или `time.sleep(10300)` для паузы при ошибках.
- **Максимальное количество потоков**:
  - Измените `max_workers=10` в `ThreadPoolExecutor` для управления количеством одновременно обрабатываемых аккаунтов.
- **Фильтры предложений**:
  - В функции `send_friend_requests` можно изменить параметр `filter='mutual'` на другие фильтры VK API (например, `filter='contacts'`) для изменения логики предложений.

## Обработка ошибок
- **Отсутствие `tokens.txt`**: Скрипт завершится с сообщением об ошибке, если файл не найден.
- **Недействительные токены**: Ошибки VK API (например, коды 1, 2, 4, 5, 6, 9, 10, 14, 15) логируются, и выполнение продолжается после паузы (30 минут).
- **Ошибки API**: Логируются с кодом ошибки и описанием; для определенных ошибок (например, пользователь не найден, код 177) заявка отклоняется.
- **Сетевые проблемы**: Обрабатываются через исключения VK API, с паузой перед повторной попыткой.

## Устранение неполадок
- **Ошибка "File not found: tokens.txt"**:
  - Убедитесь, что `tokens.txt` находится в той же директории, что и скрипт.
  - Проверьте правильность пути, указанного в переменной `tokens_file`.
- **Ошибка VK API (код 5, "Invalid token")**:
  - Проверьте токены в `tokens.txt` и перегенерируйте их через Kate Mobile или VK Dev.
- **Ошибка VK API (код 15, "Access denied")**:
  - Убедитесь, что токен имеет права `friends` и `status`.
- **Скрипт не принимает/отправляет заявки**:
  - Проверьте логи в консоли для выявления ошибок.
  - Убедитесь, что аккаунт не достиг лимита друзей (VK ограничивает до 10,000 друзей).
  - Проверьте, есть ли предложения друзей (например, если лента предложений пуста).
- **Слишком частые ошибки API**:
  - Увеличьте задержки (`time.sleep`) в функциях для снижения нагрузки на API.
  - Уменьшите `max_workers` в `ThreadPoolExecutor` для снижения параллелизма.

## Замечания по безопасности
- **Токены**: Храните `tokens.txt` в безопасном месте; не публикуйте токены публично.
- **Лимиты VK**: Скрипт включает задержки (0.3 секунды между заявками, 5 минут между проверками), чтобы избежать превышения лимитов VK API. Превышение лимитов может привести к временной блокировке токена.
- **Деактивированные аккаунты**: Скрипт автоматически отклоняет заявки от деактивированных пользователей, чтобы избежать проблем с безопасностью.

## Ограничения
- Скрипт работает только с токенами, указанными в `tokens.txt`.
- Ограничение VK на максимальное количество друзей (10,000) может остановить отправку новых заявок.
- Обработка предложений ограничена фильтром `mutual` (общие друзья); другие фильтры требуют изменения кода.
- Логирование ведется только в консоль; для сохранения логов в файл требуется доработка.

## Пример работы
1. Скрипт запускается, читает два токена из `tokens.txt`.
2. Для аккаунта "Иван Иванов (ID: 123456)":
   - Устанавливает статус "онлайн" каждые 5 минут.
   - Находит 3 входящие заявки, принимает 2 (третья от деактивированного пользователя — отклоняется).
   - Отправляет 5 исходящих заявок на основе предложений VK.
3. Для второго аккаунта выполняется аналогичный процесс в параллельном потоке.
4. При нажатии `Ctrl+C` скрипт завершает все потоки и выходит.

## Лицензия
Скрипт предоставляется "как есть" для личного использования. Убедитесь в соблюдении условий использования VK API.

## Поддержка
Для устранения проблем проверьте вывод в консоли. Если проблемы сохраняются, проверьте токены, права доступа и лимиты VK API или обратитесь за помощью к сообществу Python.
